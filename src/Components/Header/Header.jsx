import { useState, useEffect, useRef } from "react";
import "./Header.css";
import MobileNav from "./MobileNav";

export default function Header({ query, onQueryChange }) {
  const [mobileOpen, setMobileOpen] = useState(false);
  const [searchOpen, setSearchOpen] = useState(false);
  const searchWrapRef = useRef(null);
  const searchInputRef = useRef(null);

   useEffect(() => {
    if (searchOpen) {
      setTimeout(() => searchInputRef.current?.focus(), 0);
    }
  }, [searchOpen]);


   useEffect(() => {
    const onDown = (e) => {
      if (!searchOpen) return;
      if (searchWrapRef.current && !searchWrapRef.current.contains(e.target)) {
        setSearchOpen(false);
      }
    };
    window.addEventListener("mousedown", onDown);
    return () => window.removeEventListener("mousedown", onDown);
  }, [searchOpen]);

  return (
    <header className={`hdr ${searchOpen ? "hdr--searchOpen" : ""}`}>      
      <div className="hdrTop">
        <div className="container hdrTopInner">
          <div>
              <button
                className="iconBtn hdrBurger"
                type="button"
                aria-label="Open menu"
                onClick={() => setMobileOpen(true)}
              >
                <svg width="27" height="19" viewBox="0 0 27 19" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M2 0C0.89543 0 0 0.895431 0 2H2V0ZM25 0H2V2H25V0ZM27 2C27 0.89543 26.1046 0 25 0V2H27ZM25 4C26.1046 4 27 3.10457 27 2H25V2V4ZM2 4H25V2H2V4ZM0 2C0 3.10457 0.895431 4 2 4V2V2H0ZM2 7.38462C0.89543 7.38462 0 8.28005 0 9.38461H2V7.38462ZM25 7.38462H2V9.38461H25V7.38462ZM27 9.38461C27 8.28005 26.1046 7.38462 25 7.38462V9.38461H27ZM25 11.3846C26.1046 11.3846 27 10.4892 27 9.38461H25V11.3846ZM2 11.3846H25V9.38461H2V11.3846ZM0 9.38461C0 10.4892 0.895431 11.3846 2 11.3846V9.38461H0ZM2 16.7692V14.7692C0.895431 14.7692 0 15.6647 0 16.7692H2ZM2 16.7692V16.7692H0C0 17.8738 0.895431 18.7692 2 18.7692V16.7692ZM25 16.7692H2V18.7692H25V16.7692ZM25 16.7692V16.7692V18.7692C26.1046 18.7692 27 17.8738 27 16.7692H25ZM25 16.7692H27C27 15.6647 26.1046 14.7692 25 14.7692V16.7692ZM2 16.7692H25V14.7692H2V16.7692Z" fill="black"/>
                </svg>
              </button>
          </div>
          

          <div className="hdrLogo">
            <svg width="181" height="27" viewBox="0 0 181 27" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fillRule="evenodd" clipRule="evenodd" d="M30.8851 26.5968C37.3806 26.5968 42.7094 21.3468 42.7094 14.9302C42.7094 11.5563 41.527 8.70269 39.1148 6.29053L36.5293 3.68919C34.3063 1.46621 31.295 0 27.9054 0C21.3784 0 16.0811 5.26576 16.0811 11.7928C16.0811 15.2297 17.5158 18.1937 19.7545 20.4009L21.8513 22.482C24.8626 25.4617 27.3221 26.5968 30.8851 26.5968ZM18.241 26.2184H3.31081L0 22.9076V0.441441H5.37612L8.84459 3.73648V17.8153H14.9302L18.241 21.1261V26.2184ZM5.54954 1.38739V17.8153H8.27702V3.98873L5.54954 1.38739ZM2.49099 20.7004V2.77477H3.05856V20.1644H12.786V20.7004H2.49099ZM0.961711 23.0811L3.53153 25.6509H17.6734V21.3468L15.1036 18.777V23.0811H0.961711ZM18.6194 11.7928C18.6194 17.027 22.7342 21.1892 27.9054 21.1892C33.0766 21.1892 37.1914 17.027 37.1914 11.7928C37.1914 6.59008 33.0923 2.42793 27.9054 2.42793C22.6712 2.47522 18.6194 6.57432 18.6194 11.7928ZM27.9054 20.6531C32.777 20.6531 36.6081 16.7432 36.6081 11.7928C36.6081 6.8581 32.777 2.96396 27.9054 2.96396C23.0338 2.96396 19.2027 6.8581 19.2027 11.7928C19.2027 16.7432 23.0338 20.6531 27.9054 20.6531ZM21.7252 11.777C21.7568 14.1261 22.6869 16.0338 24.5 17.232C24.1689 16.4594 23.9797 15.5923 23.9797 14.4572C23.9797 10.5631 26.9437 7.48873 30.7275 7.48873C31.5788 7.48873 32.304 7.67792 32.982 8.02477C31.8311 6.36936 30.0022 5.42342 27.9054 5.39189C24.4369 5.39189 21.741 8.16666 21.7252 11.777ZM30.8851 26.0293C27.527 26.0293 25.0045 24.9887 22.214 22.1193C23.9482 23.0653 25.8874 23.6171 27.9054 23.6171C34.4324 23.6171 39.7297 18.3198 39.7297 11.7928C39.6666 9.6644 39.2725 7.99324 38.295 6.22747C40.9279 8.79729 42.1419 11.4302 42.1419 14.9302C42.1419 21.0315 37.0653 26.0293 30.8851 26.0293ZM25.4459 17.7365C26.1869 18.0518 27.0067 18.2252 27.9054 18.2252C31.3581 18.2252 34.0856 15.4031 34.0856 11.7928C34.0856 10.7522 33.8806 9.8063 33.5022 8.97071C32.6982 8.34008 31.8153 8.0563 30.7275 8.0563C27.259 8.0563 24.5473 10.8468 24.5473 14.4572C24.5473 15.9549 24.8153 16.9009 25.4459 17.7365ZM58.8221 26.5968C61.8176 26.5968 65.554 25.777 67.3986 24.7207V13.0067L63.9302 9.7117H54.9279V14.3626L58.0653 17.3581L58.6486 17.3896V17.9887C57.9549 18.1621 57.1667 18.2567 56.3468 18.2567C55.054 18.2567 53.8874 18.0203 52.8941 17.5788C52.232 16.7748 51.9167 15.7973 51.9167 14.473C51.9167 10.5315 54.7387 7.86711 58.8536 7.86711C61.4865 7.86711 64.3085 8.95495 66.0112 10.1058V4.6036L62.732 1.32432C60.6509 0.394144 57.7973 0 55.8266 0C48.8581 0 43.5766 4.90315 43.5766 11.8085C43.5766 15.3558 44.9797 18.3671 47.2658 20.5901L49.8198 23.0811C52.1847 25.3829 55.1959 26.5968 58.8221 26.5968ZM49.2522 11.9031C49.2522 14.1419 50.1824 15.9076 51.9797 17.0901C51.554 16.3648 51.3491 15.5293 51.3491 14.4572C51.3491 10.2162 54.4549 7.29954 58.8694 7.29954C61.1081 7.29954 63.4887 8.0563 65.4437 9.12837V4.82432L62.8739 2.2545V7.12612C61.5022 6.08558 58.9482 5.36035 56.5991 5.36035C52.2004 5.36035 49.2522 7.93017 49.2522 11.9031ZM55.6847 21.2049C50.0878 21.2049 46.1306 17.295 46.1306 11.7928C46.1306 6.4009 50.1824 2.53829 55.8423 2.53829C57.277 2.53829 59.2635 2.79054 60.5878 3.23198V3.81531C59.3266 3.34234 57.3085 3.07432 55.8423 3.07432C50.4977 3.07432 46.714 6.70044 46.714 11.7928C46.714 17.0112 50.4031 20.6689 55.6847 20.6689C57.3243 20.6689 59.4527 20.2748 61.0923 19.6441V12.3919H57.2455V11.8558H61.6599V19.991C59.973 20.7162 57.5766 21.2049 55.6847 21.2049ZM49.536 22.0721C52.2793 24.8468 55.0067 26.0293 58.8221 26.0293C61.5653 26.0293 64.9865 25.3198 66.8311 24.3738V13.259L64.1036 10.6576V21.5675C62.2905 22.7342 58.6486 23.6171 55.6374 23.6171C53.5563 23.6171 51.4122 23.0653 49.536 22.0721ZM58.6486 16.8063L58.3176 16.7905L55.8896 14.536H58.6486V16.8063ZM95.7612 14.9302C95.7612 21.3468 90.4324 26.5968 83.9369 26.5968C80.3739 26.5968 77.9144 25.4617 74.9031 22.482L72.8063 20.4009C70.5676 18.1937 69.1329 15.2297 69.1329 11.7928C69.1329 5.26576 74.4302 0 80.9572 0C84.3468 0 87.3581 1.46621 89.5811 3.68919L92.1666 6.29053C94.5788 8.70269 95.7612 11.5563 95.7612 14.9302ZM80.9572 21.1892C75.786 21.1892 71.6712 17.027 71.6712 11.7928C71.6712 6.57432 75.723 2.47522 80.9572 2.42793C86.1441 2.42793 90.2432 6.59008 90.2432 11.7928C90.2432 17.027 86.1284 21.1892 80.9572 21.1892ZM89.6599 11.7928C89.6599 16.7432 85.8288 20.6531 80.9572 20.6531C76.0856 20.6531 72.2545 16.7432 72.2545 11.7928C72.2545 6.8581 76.0856 2.96396 80.9572 2.96396C85.8288 2.96396 89.6599 6.8581 89.6599 11.7928ZM77.5518 17.232C75.7387 16.0338 74.8086 14.1261 74.777 11.777C74.7928 8.16666 77.4887 5.39189 80.9572 5.39189C83.054 5.42342 84.8829 6.36936 86.0338 8.02477C85.3558 7.67792 84.6306 7.48873 83.7793 7.48873C79.9955 7.48873 77.0315 10.5631 77.0315 14.4572C77.0315 15.5923 77.2207 16.4594 77.5518 17.232ZM75.2658 22.1193C78.0563 24.9887 80.5788 26.0293 83.9369 26.0293C90.1171 26.0293 95.1937 21.0315 95.1937 14.9302C95.1937 11.4302 93.9797 8.79729 91.3468 6.22747C92.3243 7.99324 92.7184 9.6644 92.7815 11.7928C92.7815 18.3198 87.4842 23.6171 80.9572 23.6171C78.9392 23.6171 77 23.0653 75.2658 22.1193ZM80.9572 18.2252C80.0585 18.2252 79.2387 18.0518 78.4977 17.7365C77.8671 16.9009 77.5991 15.9549 77.5991 14.4572C77.5991 10.8468 80.3108 8.0563 83.7793 8.0563C84.8671 8.0563 85.75 8.34008 86.554 8.97071C86.9324 9.8063 87.1374 10.7522 87.1374 11.7928C87.1374 15.4031 84.4099 18.2252 80.9572 18.2252ZM108.8 26.2184H103.266L99.955 22.9076V8.81305H97.3378L94.027 5.50225V0.441441H111.259L114.57 3.75225V8.81305H108.8V26.2184ZM103.486 25.6509L100.917 23.0811H105.505V5.67567H111.432V1.40315L114.002 3.97297V8.24549H108.232V25.6509H103.486ZM102.446 3.31081V20.7477H103.014V3.31081H109.115V2.79054H96.3446V3.31081H102.446ZM97.5586 8.24549L94.9887 5.67567H99.9549V8.24549H97.5586ZM131.218 26.2184H125.685L122.374 22.9076V14.0473L113.561 0.441441H120.34L125.574 3.65765L126.773 5.6599L129.878 0.441441H136.358L138.754 3.53153L131.218 14.9144V26.2184ZM125.905 25.6509L123.336 23.0811H127.923V14.0473L136.232 1.21396L138.061 3.56306L130.651 14.7567V25.6509H125.905ZM121.097 1.57658L125.149 8.37161L126.441 6.21171L125.164 4.06756L121.097 1.57658ZM124.865 20.7477V13.4324L118.164 2.77477H118.827L125.149 12.9279L131.502 2.77477H132.164L125.432 13.464V20.7477H124.865ZM148.892 26.2184H143.358L140.047 22.9076V0.441441H148.971C151.635 0.441441 153.89 1.43468 155.45 2.99549L157.989 5.53378C159.581 7.12612 160.306 8.95495 160.306 11.3671C160.306 15.9392 156.365 19.5338 151.32 19.5338H148.892V26.2184ZM142.538 20.7477V2.68018H148.971C152.518 2.68018 154.962 4.93468 154.962 8.22972C154.962 11.7612 152.297 14.3311 148.655 14.3311H143.106V20.7477H142.538ZM148.655 13.795H143.106V3.21621H148.971C152.203 3.21621 154.378 5.23423 154.378 8.22972C154.378 11.4617 151.966 13.795 148.655 13.795ZM143.579 25.6509L141.009 23.0811H145.597V16.554H148.655C153.685 16.554 157.468 12.991 157.484 8.26125C157.484 7.12612 157.279 6.11711 156.838 5.13963C159.061 7.23648 159.739 8.67116 159.739 11.3671C159.739 15.6239 156.065 18.9662 151.32 18.9662H148.324V25.6509H143.579ZM145.597 5.45495V11.5721H148.009V7.86711H151.809C151.541 6.44819 150.405 5.48648 148.908 5.45495H145.597ZM148.577 11.5721V8.43468H151.872V8.54504C151.872 10.232 150.547 11.5721 148.845 11.5721H148.577ZM180.833 26.2184H165.43L162.119 22.9076V0.441441H177.081L180.392 3.75225V8.02477H170.743V8.98648H175.599L178.91 12.2973V17.0112H170.743V17.973H177.523L180.833 21.2838V26.2184ZM167.606 8.98648V5.48648H177.254V1.40315L179.824 3.97297V7.4572H170.176V8.98648H167.606ZM164.563 2.69594V20.795H175.378V20.259H165.131V11.8401H173.455V11.304H165.131V3.23198H174.937V2.69594H164.563ZM167.606 17.973V14.1576H175.773V9.94819L178.342 12.518V16.4437H170.176V17.973H167.606ZM163.081 23.0811L165.651 25.6509H180.266V21.5045L177.696 18.9347V23.0811H163.081Z" fill="black"/>
            </svg>
          </div>

           <div ref={searchWrapRef} className={`hdrSearch ${searchOpen ? "hdrSearch--open" : ""}`}>
            <input
              id="searchInput"
              ref={searchInputRef}
              className="hdrSearchInput"
              value={query}
              onChange={(e) => onQueryChange(e.target.value)}
              type="search"
              placeholder="Search..."
              aria-label="Search posts"
            />

            <button
              className="iconBtn"
              type="button"
              aria-label={searchOpen ? "Close search" : "Open search"}
              onClick={() => setSearchOpen((v) => !v)}
            >
              <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M11.8841 13.2957L12.2584 12.9642C12.0855 12.769 11.7917 12.7395 11.5834 12.8963L11.8841 13.2957ZM13.2957 11.8841L12.8963 11.5834C12.7395 11.7917 12.769 12.0855 12.9642 12.2584L13.2957 11.8841ZM13.3404 11.9262L12.9869 12.2798V12.2798L13.3404 11.9262ZM17.2071 15.7929L17.5607 15.4393V15.4393L17.2071 15.7929ZM17.2071 17.2071L17.5607 17.5607L17.5607 17.5607L17.2071 17.2071ZM15.7929 17.2071L15.4393 17.5607H15.4393L15.7929 17.2071ZM11.9262 13.3404L12.2798 12.9869V12.9869L11.9262 13.3404ZM7.61111 13.2222C10.71 13.2222 13.2222 10.71 13.2222 7.61111H12.2222C12.2222 10.1578 10.1578 12.2222 7.61111 12.2222V13.2222ZM2 7.61111C2 10.71 4.51218 13.2222 7.61111 13.2222V12.2222C5.06447 12.2222 3 10.1578 3 7.61111H2ZM7.61111 2C4.51218 2 2 4.51218 2 7.61111H3C3 5.06447 5.06447 3 7.61111 3V2ZM13.2222 7.61111C13.2222 4.51218 10.71 2 7.61111 2V3C10.1578 3 12.2222 5.06447 12.2222 7.61111H13.2222ZM7.61111 15.2222C9.32702 15.2222 10.9116 14.6538 12.1849 13.6952L11.5834 12.8963C10.4775 13.7289 9.10264 14.2222 7.61111 14.2222V15.2222ZM0 7.61111C0 11.8146 3.40761 15.2222 7.61111 15.2222V14.2222C3.9599 14.2222 1 11.2623 1 7.61111H0ZM7.61111 0C3.40761 0 0 3.40761 0 7.61111H1C1 3.9599 3.9599 1 7.61111 1V0ZM15.2222 7.61111C15.2222 3.40761 11.8146 0 7.61111 0V1C11.2623 1 14.2222 3.9599 14.2222 7.61111H15.2222ZM13.6952 12.1849C14.6538 10.9116 15.2222 9.32702 15.2222 7.61111H14.2222C14.2222 9.10264 13.7289 10.4775 12.8963 11.5834L13.6952 12.1849ZM12.9642 12.2584C12.9719 12.2653 12.9795 12.2724 12.9869 12.2798L13.694 11.5727C13.6722 11.5509 13.65 11.53 13.6273 11.5099L12.9642 12.2584ZM12.9869 12.2798L16.8536 16.1464L17.5607 15.4393L13.694 11.5727L12.9869 12.2798ZM16.8536 16.1464C17.0488 16.3417 17.0488 16.6583 16.8536 16.8536L17.5607 17.5607C18.1464 16.9749 18.1464 16.0251 17.5607 15.4393L16.8536 16.1464ZM16.8536 16.8536C16.6583 17.0488 16.3417 17.0488 16.1464 16.8536L15.4393 17.5607C16.0251 18.1464 16.9749 18.1464 17.5607 17.5607L16.8536 16.8536ZM16.1464 16.8536L12.2798 12.9869L11.5727 13.694L15.4393 17.5607L16.1464 16.8536ZM12.2798 12.9869C12.2724 12.9795 12.2653 12.9719 12.2584 12.9642L11.5099 13.6273C11.53 13.65 11.5509 13.6722 11.5727 13.694L12.2798 12.9869Z" fill="black"/>
              </svg>
            </button>
          </div>
        </div>
      </div>

    
      <MobileNav open={mobileOpen} onClose={() => setMobileOpen(false)} />
    </header>
  );
}
